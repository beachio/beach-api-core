class BeachChat {
  constructor (params) {
    this.url = new URL("/screens/view", params.url || window.location.origin).href
    this.bot_uuid = params.bot_uuid
    this.id = "beach_chat_"+this.__guid__()
    this.class = 'beach-chat'
    this.iframeStyle = 'min-height: 400px; position: fixed; display: none; right: 15px; bottom: 15px; width: 375px; border: none; border-radius: 8px; max-height: calc(100% - 150px); height: 500px; box-shadow: 0 0 5px rgba(0,0,0,.15);'
  }

  build () {
    var markup = "<iframe id='"+this.id+"' class='"+this.class+"' style='"+this.iframeStyle+"' src='"+this.url+"?bot_uuid="+this.bot_uuid+"'></iframe>"
    return markup
  }

  init() {
    document.body.innerHTML += this.build()
    this.iframe = document.getElementById(this.id)

    this.iframe.addEventListener("load", () => {
      this.iframe.style.display = "block"
      this.iframe.contentWindow.postMessage('message','*');
    })

  }

  __guid__ () {
    function s4() {
      return Math.floor((1 + Math.random()) * 0x10000)
        .toString(16)
        .substring(1);
    }
    return s4() + s4();
  }
}